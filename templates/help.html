{% extends "base.html" %}

{% block title %}User Manual - Read-a-Thon System{% endblock %}

{% block content %}
<style>
    html {
        scroll-behavior: smooth;
    }
    .sticky-toc {
        position: sticky;
        top: 20px;
        max-height: calc(100vh - 40px);
        overflow-y: auto;
    }
    .toc-link {
        display: block;
        padding: 0.5rem 1rem;
        color: #495057;
        text-decoration: none;
        border-left: 3px solid transparent;
        transition: all 0.2s;
    }
    .toc-link:hover {
        color: #007bff;
        border-left-color: #007bff;
        background-color: #f8f9fa;
    }
    .toc-link.active {
        color: #007bff;
        border-left-color: #007bff;
        font-weight: 600;
    }
    .toc-section {
        font-size: 0.9rem;
    }
    /* Offset anchor targets for sticky navbar */
    .card[id] {
        scroll-margin-top: 70px;
    }
</style>

<div class="row">
    <div class="col-lg-3">
        <!-- Sticky Table of Contents -->
        <div class="sticky-toc">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-list"></i> Table of Contents</h5>
                </div>
                <div class="card-body p-0">
                    <nav class="toc-section">
                        <a href="#readathon-data" class="toc-link">About ReadAThon.com Data</a>
                        <a href="#quick-start" class="toc-link">Quick Start Guide</a>
                        <a href="#school-banner" class="toc-link">School Page Headline Banner</a>
                        <a href="#data-persistence" class="toc-link">Data Persistence</a>
                        <a href="#prod-vs-sample" class="toc-link">Production vs Sample Data</a>
                        <a href="#uploading-data" class="toc-link">Uploading Daily Data</a>
                        <a href="#reports-page" class="toc-link">Reports & Data Page</a>
                        <a href="#workflows" class="toc-link">Workflows</a>
                        <a href="#dashboard-tabs" class="toc-link">Dashboard Tabs</a>
                        <a href="#business-logic" class="toc-link">Business Logic & Rules</a>
                        <a href="#troubleshooting" class="toc-link">Troubleshooting</a>
                        <a href="#tips-tricks" class="toc-link">Tips & Tricks</a>
                    </nav>                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-9">
        <h1 class="mb-4">
            <i class="bi bi-book"></i> Read-a-Thon System - User Manual
        </h1>

        <!-- ReadAThon.com Data Source Notice -->
        <div class="card mb-4 border-warning" id="readathon-data">
            <div class="card-header bg-warning text-dark">
                <h4 class="mb-0"><i class="bi bi-info-circle"></i> About ReadAThon.com Data</h4>
            </div>
            <div class="card-body">
                <p class="lead"><strong>This application requires CSV data from <a href="https://www.read-a-thon.com/" target="_blank">ReadAThon.com</a></strong></p>

                <p>The Read-a-Thon System is designed to <strong>enhance and extend</strong> the data you download from the official ReadAThon.com platform. While ReadAThon.com manages pledges and online donations, this application adds:</p>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <h6 class="text-primary"><i class="bi bi-trophy"></i> Additional Features</h6>
                        <ul>
                            <li>Team competition tracking and leaderboards</li>
                            <li>Daily reading minute caps (120 min/day max)</li>
                            <li>Participation rate calculations</li>
                            <li>Grade-level and class-level analytics</li>
                            <li>Custom reports and data exports</li>
                            <li>Multi-year database management</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-success"><i class="bi bi-download"></i> How to Get Data</h6>
                        <ol>
                            <li>Log in to <a href="https://www.read-a-thon.com/" target="_blank">ReadAThon.com</a></li>
                            <li>Navigate to your school's dashboard</li>
                            <li>Download CSV exports (daily logs and cumulative stats)</li>
                            <li>Use the <strong>Upload</strong> tab to import into this app</li>
                        </ol>
                    </div>
                </div>

                <div class="alert alert-primary mt-3 mb-0">
                    <strong><i class="bi bi-arrow-right-circle"></i> Next Steps:</strong>
                    After installation, visit <a href="https://www.read-a-thon.com/" target="_blank" class="alert-link">ReadAThon.com</a> to download your school's data,
                    then use the <strong>Upload</strong> page to import it into the system.
                </div>

                <div class="alert alert-info mt-3 mb-0">
                    <strong><i class="bi bi-github"></i> Get the Application:</strong>
                    Download or clone from GitHub: <a href="https://github.com/stevensouza/readathon" target="_blank" class="alert-link">github.com/stevensouza/readathon</a>
                    <br>See the <a href="/help/installation" class="alert-link">Installation Guide</a> for complete setup instructions.
                </div>
            </div>
        </div>

        <!-- Quick Start -->
        <div class="card mb-4" id="quick-start">
            <div class="card-header card-header-blue">
                <h4 class="mb-0"><i class="bi bi-rocket"></i> Quick Start Guide</h4>
            </div>
            <div class="card-body">
                <h5>Daily Workflow (3 Simple Steps)</h5>
                <ol class="lead">
                    <li>Click <strong>"Upload"</strong> ‚Üí Select date ‚Üí Upload your CSV files</li>
                    <li>Click <strong>"Reports & Data"</strong> ‚Üí Select a report ‚Üí Click "Run Report"</li>
                    <li>Use <strong>"Copy to Clipboard"</strong> or <strong>"Export CSV"</strong> buttons</li>
                </ol>

                <h5 class="mt-4">Navigation Overview</h5>
                <p>The application has 6 main tabs:</p>
                <ul>
                    <li><strong>School:</strong> School-wide overview with team competition</li>
                    <li><strong>Teams:</strong> Head-to-head team comparison metrics</li>
                    <li><strong>Grade Level:</strong> Grade-by-grade and class-by-class breakdown</li>
                    <li><strong>Students:</strong> Individual student performance (master-detail view)</li>
                    <li><strong>Upload:</strong> Import daily reading and cumulative stats</li>
                    <li><strong>Reports & Data:</strong> 22 pre-configured reports, table views, and workflows</li>
                    <li><strong>Admin:</strong> Database management, creation, registry, and comparison tools</li>
                </ul>

                <div class="alert alert-info mt-3">
                    <strong><i class="bi bi-lightbulb"></i> Pro Tip:</strong> Use the <strong>environment selector</strong> in the top-right to switch between Production and Sample data!
                </div>
            </div>
        </div>

        <!-- School Page Headline Banner -->
        <div class="card mb-4" id="school-banner">
            <div class="card-header card-header-blue">
                <h4 class="mb-0"><i class="bi bi-graph-up"></i> School Page Headline Banner</h4>
            </div>
            <div class="card-body">
                <h5>Understanding the Headline Banner</h5>
                <p>The School tab displays a prominent dark blue banner at the top showing 6 key metrics in a horizontal row. This banner provides an at-a-glance summary of your read-a-thon progress.</p>

                <h5 class="mt-4">The 6 Metrics</h5>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="card border-info mb-3">
                            <div class="card-body">
                                <h6 class="card-title"><i class="bi bi-calendar-event"></i> 1. Campaign Day</h6>
                                <ul class="small">
                                    <li><strong>Shows:</strong> Current day of total days (e.g., "3 of 6")</li>
                                    <li><strong>Subtitle:</strong> Current date</li>
                                    <li><strong>Does NOT honor date filter</strong> - always shows "today"</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-info mb-3">
                            <div class="card-body">
                                <h6 class="card-title"><i class="bi bi-cash-coin"></i> 2. Fundraising</h6>
                                <ul class="small">
                                    <li><strong>Shows:</strong> Total $ raised (e.g., "$31,758")</li>
                                    <li><strong>Subtitle:</strong> Student count and percentage (e.g., "328 of 411 Students (79.8%)")</li>
                                    <li><strong>Does NOT honor date filter</strong> - always cumulative</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card border-info mb-3">
                            <div class="card-body">
                                <h6 class="card-title"><i class="bi bi-book"></i> 3. Minutes Read <span class="filter-indicator">‚óê</span></h6>
                                <ul class="small">
                                    <li><strong>Shows:</strong> Total hours + minutes (e.g., "1,835 hours (110,093 min)")</li>
                                    <li><strong>Capped:</strong> Maximum 120 minutes per student per day</li>
                                    <li><strong>‚óê icon appears</strong> when date filter is active</li>
                                    <li><strong>Honors date filter</strong> - shows cumulative through selected date</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-info mb-3">
                            <div class="card-body">
                                <h6 class="card-title"><i class="bi bi-gift"></i> 4. Sponsors</h6>
                                <ul class="small">
                                    <li><strong>Shows:</strong> Total sponsor count (e.g., "782")</li>
                                    <li><strong>Subtitle:</strong> Student count and percentage (e.g., "328 of 411 Students (79.8%)")</li>
                                    <li><strong>Does NOT honor date filter</strong> - always cumulative</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card border-info mb-3">
                            <div class="card-body">
                                <h6 class="card-title"><i class="bi bi-people"></i> 5. Avg. Participation (With Color) <span class="filter-indicator">‚óê</span></h6>
                                <ul class="small">
                                    <li><strong>Shows:</strong> Average daily participation percentage (e.g., "59.7%")</li>
                                    <li><strong>Subtitle:</strong> Student count (e.g., "245 of 411 Students")</li>
                                    <li><strong>Includes:</strong> Team color day bonus minutes</li>
                                    <li><strong>Can exceed 100%</strong> due to color bonus</li>
                                    <li><strong>‚óê icon appears</strong> when date filter is active</li>
                                    <li><strong>Honors date filter</strong> - calculates average through selected date</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-info mb-3">
                            <div class="card-body">
                                <h6 class="card-title"><i class="bi bi-target"></i> 6. Goal Met (‚â•1 Day) <span class="filter-indicator">‚óê</span></h6>
                                <ul class="small">
                                    <li><strong>Shows:</strong> Percentage of students who met their goal at least once (e.g., "78.8%")</li>
                                    <li><strong>Subtitle:</strong> Student count (e.g., "324 of 411 Students")</li>
                                    <li><strong>Goal:</strong> Reading time equals or exceeds daily goal</li>
                                    <li><strong>‚óê icon appears</strong> when date filter is active</li>
                                    <li><strong>Honors date filter</strong> - counts goals met through selected date</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <h5 class="mt-4">Date Filtering</h5>
                <p>The School page includes a <strong>Filter Period</strong> dropdown above the banner that allows you to filter data by date:</p>
                <ul>
                    <li><strong>"All Days"</strong> - Shows cumulative data across entire read-a-thon</li>
                    <li><strong>Single Date</strong> - Shows data cumulative through that specific date</li>
                    <li><strong>Relative Days</strong> - "Day 1", "Day 2", etc. for easy navigation</li>
                </ul>
                <p>When a date filter is active:</p>
                <ul>
                    <li>The <strong>‚óê icon</strong> appears on metrics that honor the filter (Minutes, Avg. Participation, Goal Met)</li>
                    <li>Hovering over ‚óê shows a tooltip: "Cumulative through [date]"</li>
                    <li>Metrics without ‚óê (Campaign Day, Fundraising, Sponsors) remain unchanged</li>
                </ul>

                <div class="alert alert-info">
                    <strong><i class="bi bi-lightbulb"></i> Pro Tip:</strong> Use the date filter to track daily progress! Compare early days vs. later days to see momentum changes.
                </div>

                <div class="alert alert-success">
                    <strong><i class="bi bi-shield-check"></i> Data Integrity:</strong> Compare banner values with the <a href="https://ReadAThon.com" target="_blank">ReadAThon.com</a> online system to ensure accuracy before generating reports!
                </div>
            </div>
        </div>

        <!-- Data Persistence -->
        <div class="card mb-4" id="data-persistence">
            <div class="card-header card-header-blue">
                <h4 class="mb-0"><i class="bi bi-database"></i> Data Persistence</h4>
            </div>
            <div class="card-body">
                <h5>Your Data is Safe!</h5>
                <p><strong>All data is permanently stored on your Mac's hard drive</strong> in SQLite database files:</p>
                <ul>
                    <li><code>readathon_prod.db</code> - Your real read-a-thon data</li>
                    <li><code>readathon_sample.db</code> - Sample test data</li>
                </ul>
                <p>The data is <strong>NOT</strong> stored in memory - it survives:</p>
                <ul>
                    <li>‚úÖ Stopping and restarting the application</li>
                    <li>‚úÖ Computer restarts</li>
                    <li>‚úÖ Power outages</li>
                    <li>‚úÖ Everything!</li>
                </ul>
                <div class="alert alert-success">
                    <strong>You can safely close the app at any time.</strong> Your data will still be there when you restart!
                </div>
            </div>
        </div>

        <!-- Environment Selector -->
        <div class="card mb-4" id="prod-vs-sample">
            <div class="card-header card-header-blue">
                <h4 class="mb-0"><i class="bi bi-toggle-on"></i> Production vs Sample Data</h4>
            </div>
            <div class="card-body">
                <h5>What's the Environment Selector?</h5>
                <p>The dropdown in the top-right corner lets you switch between two completely separate databases:</p>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card border-primary">
                            <div class="card-body">
                                <h6 class="card-title text-primary"><i class="bi bi-building"></i> Production</h6>
                                <ul class="small">
                                    <li>Your real read-a-thon data</li>
                                    <li>411 students pre-loaded</li>
                                    <li>All real daily uploads go here</li>
                                    <li>Use for actual reporting</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-secondary">
                            <div class="card-body">
                                <h6 class="card-title text-secondary"><i class="bi bi-flask"></i> Sample</h6>
                                <ul class="small">
                                    <li>Test data for practice</li>
                                    <li>Same student roster</li>
                                    <li>Safe to experiment</li>
                                    <li>Use for learning/testing</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alert alert-warning mt-3">
                    <strong>Note:</strong> The two environments are completely separate. Data uploaded to Sample will NOT appear in Production!
                </div>
            </div>
        </div>

        <!-- Upload Data -->
        <div class="card mb-4" id="uploading-data">
            <div class="card-header card-header-blue">
                <h4 class="mb-0"><i class="bi bi-upload"></i> Uploading Daily Data</h4>
            </div>
            <div class="card-body">
                <h5>Two Types of Uploads</h5>
                <p>There are two separate upload processes:</p>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card border-primary mb-3">
                            <div class="card-body">
                                <h6 class="card-title text-primary">1. Daily Minutes Upload</h6>
                                <p class="small"><strong>When:</strong> Upload this every day after students read</p>
                                <p class="small"><strong>File Format:</strong> CSV with columns:</p>
                                <ul class="small">
                                    <li><code>Reader Name</code> or <code>Student Name</code></li>
                                    <li><code>Minutes</code> or <code>Minutes Read</code></li>
                                </ul>
                                <p class="small"><strong>What it does:</strong> Records daily reading activity and updates Daily_Logs table</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-success mb-3">
                            <div class="card-body">
                                <h6 class="card-title text-success">2. Cumulative Stats Upload</h6>
                                <p class="small"><strong>When:</strong> Upload when donation totals change in the online system</p>
                                <p class="small"><strong>File Format:</strong> CSV with columns:</p>
                                <ul class="small">
                                    <li><code>Reader Name</code> or <code>Student Name</code></li>
                                    <li><code>Donations</code> or <code>Donation Amount</code></li>
                                    <li><code>Minutes</code> (cumulative total)</li>
                                    <li><code>Sponsors</code> (optional)</li>
                                </ul>
                                <p class="small"><strong>What it does:</strong> Updates Reader_Cumulative table with fundraising data</p>
                            </div>
                        </div>
                    </div>
                </div>

                <h5 class="mt-3">Upload Process</h5>
                <ol>
                    <li>Navigate to <strong>Upload Data</strong> page</li>
                    <li><strong>For Daily Upload:</strong> Select date ‚Üí Upload minutes file</li>
                    <li><strong>For Cumulative Upload:</strong> Upload the cumulative stats file (no date needed)</li>
                    <li>Click the appropriate <strong>"Upload"</strong> button</li>
                </ol>

                <div class="alert alert-info">
                    <strong><i class="bi bi-info-circle"></i> Tips:</strong>
                    <ul class="mb-0">
                        <li>Student names must match the roster exactly (case-sensitive)</li>
                        <li>Any unrecognized names will be shown as warnings</li>
                        <li>You can re-upload data to update/correct values</li>
                        <li>The system tracks all uploads in the Upload_History table</li>
                        <li>Check the verification boxes on the Dashboard to confirm your uploads worked correctly</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Reports & Data Page -->
        <div class="card mb-4" id="reports-page">
            <div class="card-header card-header-blue">
                <h4 class="mb-0"><i class="bi bi-graph-up"></i> Reports & Data Page</h4>
            </div>
            <div class="card-body">
                <h5>Three Sections in One Page</h5>
                <p>The Reports & Data page consolidates three key functions into accordion sections:</p>

                <h6 class="mt-3">1. Reports Section</h6>
                <p>22 pre-configured reports with enhanced metadata:</p>
                <ul>
                    <li><strong>Column Descriptions:</strong> Every column explained</li>
                    <li><strong>Data Sources:</strong> Shows which database tables power each metric</li>
                    <li><strong>Key Terms:</strong> Glossary of important definitions</li>
                    <li><strong>Automated Analysis:</strong> Click the <span class="badge bg-primary">üîç Analysis</span> button to see data insights</li>
                </ul>

                <table class="table table-hover table-sm mt-3">
                    <thead class="table-light">
                        <tr>
                            <th>Report</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Q1</strong></td>
                            <td><span class="badge bg-secondary">Utility</span></td>
                            <td>Shows row counts in each database table</td>
                        </tr>
                        <tr>
                            <td><strong>Q2</strong></td>
                            <td><span class="badge bg-info">Daily</span></td>
                            <td>Comprehensive daily summary by class or team</td>
                        </tr>
                        <tr>
                            <td><strong>Q4 / Slide 4</strong></td>
                            <td><span class="badge bg-info">Daily</span></td>
                            <td>Random prize drawing - one winner per grade</td>
                        </tr>
                        <tr>
                            <td><strong>Q5</strong></td>
                            <td><span class="badge bg-success">Cumulative</span></td>
                            <td>Student cumulative stats (Top Readers, Goal Getters, Fundraisers)</td>
                        </tr>
                        <tr>
                            <td><strong>Q6</strong></td>
                            <td><span class="badge bg-success">Cumulative</span></td>
                            <td>Class participation winner by average participation rate</td>
                        </tr>
                        <tr>
                            <td><strong>Q7</strong></td>
                            <td><span class="badge bg-warning text-dark">Export</span></td>
                            <td>Complete denormalized log for export to Excel</td>
                        </tr>
                        <tr>
                            <td><strong>Q14 / Slide 3</strong></td>
                            <td><span class="badge bg-success">Cumulative</span></td>
                            <td>Team participation winner</td>
                        </tr>
                        <tr>
                            <td><strong>Q18 / Slide 2</strong></td>
                            <td><span class="badge bg-success">Cumulative</span></td>
                            <td>Leading class in each grade by total minutes</td>
                        </tr>
                        <tr>
                            <td><strong>Q19 / Slide 5</strong></td>
                            <td><span class="badge bg-success">Cumulative</span></td>
                            <td>Total minutes read by each team</td>
                        </tr>
                        <tr>
                            <td><strong>Q20 / Slide 6</strong></td>
                            <td><span class="badge bg-success">Cumulative</span></td>
                            <td>Total donations raised by each team</td>
                        </tr>
                        <tr>
                            <td><strong>Q21-Q23</strong></td>
                            <td><span class="badge bg-danger">Integrity</span></td>
                            <td>Data reconciliation and validation reports</td>
                        </tr>
                    </tbody>
                </table>

                <h6 class="mt-4">2. Tables Section</h6>
                <p>View raw database tables:</p>
                <ul>
                    <li>Roster, Class Info, Grade Rules</li>
                    <li>Daily Logs, Reader Cumulative</li>
                    <li>Upload History (audit trail)</li>
                    <li>Team Color Bonus</li>
                    <li>All tables support sorting, copy to clipboard, and CSV export</li>
                </ul>

                <h6 class="mt-4">3. Admin Section (NEW - Significantly Expanded)</h6>
                <p>Comprehensive database management and analytics tools organized in 5 tabs:</p>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="card border-info mb-3">
                            <div class="card-body">
                                <h6 class="card-title text-info"><i class="bi bi-gear"></i> Tab 1: Actions</h6>
                                <ul class="small">
                                    <li>Selective table clearing (clear specific tables without affecting others)</li>
                                    <li>Upload history viewer</li>
                                    <li>Database integrity tools</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-success mb-3">
                            <div class="card-body">
                                <h6 class="card-title text-success"><i class="bi bi-folder"></i> Tab 2: Data Management</h6>
                                <ul class="small">
                                    <li>View and manage all database tables</li>
                                    <li>Export data to CSV</li>
                                    <li>View table statistics</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <div class="card border-primary mb-3">
                            <div class="card-body">
                                <h6 class="card-title text-primary"><i class="bi bi-plus-circle"></i> Tab 3: Database Creation (NEW v2026.10.0)</h6>
                                <p class="small"><strong>Create new read-a-thon databases for future years:</strong></p>
                                <ul class="small">
                                    <li>Enter school year (e.g., 2027)</li>
                                    <li>Auto-generate filename (e.g., readathon_2027.db)</li>
                                    <li>Upload 3 CSV files: Roster, Class Info, Grade Rules</li>
                                    <li>Automatic database creation with data loading</li>
                                    <li>Built-in CSV validation</li>
                                    <li>Automatic registry in Database_Metadata</li>
                                </ul>
                                <div class="alert alert-info small mb-0">
                                    <strong>Use Case:</strong> At the start of each new school year, create a new database with updated rosters and rules.
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-warning mb-3">
                            <div class="card-body">
                                <h6 class="card-title text-warning"><i class="bi bi-hdd-stack"></i> Tab 4: Database Registry (v2026.11.0)</h6>
                                <p class="small"><strong>Manage all read-a-thon databases across years:</strong></p>
                                <ul class="small">
                                    <li>View all registered databases (2025, 2026, Sample, etc.)</li>
                                    <li>Switch active database via dropdown selector</li>
                                    <li>View database metadata (year, description, statistics)</li>
                                    <li>Register existing databases</li>
                                    <li>Maintain historical event records</li>
                                </ul>
                                <div class="alert alert-warning small mb-0">
                                    <strong>Note:</strong> Only ONE database is active at a time. Switch between years using the header dropdown.
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-danger mb-3">
                            <div class="card-body">
                                <h6 class="card-title text-danger"><i class="bi bi-graph-up-arrow"></i> Tab 5: Database Comparison (NEW v2026.12.0)</h6>
                                <p class="small"><strong>Year-over-year analysis tool with 50 comprehensive metrics:</strong></p>
                                <ul class="small">
                                    <li><strong>50 metrics</strong> across 5 entity levels (School, Team, Grade, Class, Student)</li>
                                    <li>Compare any two databases side-by-side</li>
                                    <li>Date filtering (All Dates, specific date ranges)</li>
                                    <li>Sortable comparison table</li>
                                    <li>Search box for quick metric lookup</li>
                                    <li>Entity type filter (show only School, Team, Grade, Class, or Student metrics)</li>
                                    <li>Export to CSV for analysis</li>
                                    <li>Color-coded winners (blue/orange ovals)</li>
                                    <li>Sticky filter selections via sessionStorage</li>
                                </ul>
                                <div class="alert alert-danger small mb-0">
                                    <strong>Example Use Case:</strong> Compare 2025 vs. 2026 fundraising totals, reading minutes, participation rates, and more to track year-over-year growth.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <h6 class="mt-3">Database Comparison Metrics Breakdown (50 total)</h6>
                <div class="accordion" id="dbComparisonMetrics">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#metricsSchool">
                                School Level (10 metrics)
                            </button>
                        </h2>
                        <div id="metricsSchool" class="accordion-collapse collapse" data-bs-parent="#dbComparisonMetrics">
                            <div class="accordion-body">
                                <ol class="small">
                                    <li>Fundraising Total</li>
                                    <li>Reading Minutes Total</li>
                                    <li>Sponsor Count</li>
                                    <li>Total Participating (‚â•1 Day)</li>
                                    <li>School Size (Total Students)</li>
                                    <li>Average Participation % (With Color War Bonus)</li>
                                    <li>Goal Met (‚â•1 Day)</li>
                                    <li>All N Days Active %</li>
                                    <li>Goal Met All Days %</li>
                                    <li>Color War Points</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#metricsOther">
                                Team, Grade, Class (10 metrics each = 30 total)
                            </button>
                        </h2>
                        <div id="metricsOther" class="accordion-collapse collapse" data-bs-parent="#dbComparisonMetrics">
                            <div class="accordion-body">
                                <p class="small">Same 10 metrics as School level, but calculated per Team/Grade/Class:</p>
                                <ol class="small">
                                    <li>Fundraising Total</li>
                                    <li>Reading Minutes Total</li>
                                    <li>Sponsor Count</li>
                                    <li>Total Participating (‚â•1 Day)</li>
                                    <li>Size (Total Students)</li>
                                    <li>Average Participation % (With Color War Bonus)</li>
                                    <li>Goal Met (‚â•1 Day)</li>
                                    <li>All N Days Active %</li>
                                    <li>Goal Met All Days %</li>
                                    <li>Color War Points</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#metricsStudent">
                                Student Level (10 metrics)
                            </button>
                        </h2>
                        <div id="metricsStudent" class="accordion-collapse collapse" data-bs-parent="#dbComparisonMetrics">
                            <div class="accordion-body">
                                <ol class="small">
                                    <li>Top Fundraiser</li>
                                    <li>Top Reader (Minutes)</li>
                                    <li>Top Sponsor Count</li>
                                    <li>Total Participating (‚â•1 Day) - N/A for individuals</li>
                                    <li>Top Participation %</li>
                                    <li>Goal Met (‚â•1 Day)</li>
                                    <li>All N Days Active %</li>
                                    <li>Goal Met All Days %</li>
                                    <li>Average Minutes Per Day</li>
                                    <li>Total Days Active</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>

                <h5 class="mt-3">Report Options</h5>
                <ul>
                    <li><strong>Date Filter:</strong> Some reports can show data for a specific date or all dates</li>
                    <li><strong>Group By:</strong> Q2 can group by class or team</li>
                    <li><strong>Sort By:</strong> Q5 can sort by minutes, goals, or donations</li>
                    <li><strong>Limit:</strong> Q5 can show top 10, 25, 50, or all students</li>
                </ul>
            </div>
        </div>

        <!-- Workflows -->
        <div class="card mb-4" id="workflows">
            <div class="card-header card-header-blue">
                <h4 class="mb-0"><i class="bi bi-diagram-3"></i> Workflows</h4>
            </div>
            <div class="card-body">
                <h5>What are Workflows?</h5>
                <p>Workflows run multiple reports in sequence, perfect for generating all your slide deck data at once!</p>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card border-success mb-3">
                            <div class="card-body">
                                <h6 class="card-title">QD: Daily Slide Update</h6>
                                <p class="small">Runs all reports needed for daily slideshow:</p>
                                <ul class="small">
                                    <li>Slide 2: Lead Class by Grade</li>
                                    <li>Slide 3: Team Participation</li>
                                    <li>Slide 4: Prize Drawing</li>
                                    <li>Slide 5: Team Minutes</li>
                                    <li>Slide 6: Team Donations</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-info mb-3">
                            <div class="card-body">
                                <h6 class="card-title">QC: Cumulative Workflow</h6>
                                <p class="small">Runs all cumulative prize reports:</p>
                                <ul class="small">
                                    <li>Q5: Student Cumulative</li>
                                    <li>Q6: Class Participation</li>
                                    <li>Q14: Team Participation</li>
                                    <li>Q18: Lead Class by Grade</li>
                                    <li>Q19: Team Minutes</li>
                                    <li>Q20: Team Donations</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Tabs -->
        <div class="card mb-4" id="dashboard-tabs">
            <div class="card-header card-header-blue">
                <h4 class="mb-0"><i class="bi bi-grid-3x3"></i> Dashboard Tabs</h4>
            </div>
            <div class="card-body">
                <h5>School Tab</h5>
                <p>School-wide overview showing:</p>
                <ul>
                    <li>6-metric headline banner (Campaign Day, Fundraising, Minutes, Sponsors, Avg. Participation, Goal Met)</li>
                    <li>Team competition (head-to-head comparison)</li>
                    <li>Top performers (students and classes)</li>
                    <li>Participation breakdown</li>
                </ul>

                <h5 class="mt-3">Teams Tab</h5>
                <p>Detailed team competition metrics:</p>
                <ul>
                    <li>4-column layout (2 rows √ó 4 cards per team)</li>
                    <li>Fundraising leaders, top classes, reading leaders for each team</li>
                    <li>Colored oval highlights around winning values</li>
                    <li>Comparison table showing all metrics side-by-side</li>
                </ul>

                <h5 class="mt-3">Grade Level Tab</h5>
                <p>Grade-by-grade and class-by-class breakdown:</p>
                <ul>
                    <li>Filter by grade (K, 1, 2, 3, 4, 5, or All Grades)</li>
                    <li>Grade-level cards showing total metrics per grade</li>
                    <li>Class detail table (sortable by any column)</li>
                    <li>Gold highlights for school-wide winners, silver for grade-level winners</li>
                    <li>Team badges showing which team each class belongs to</li>
                </ul>

                <h5 class="mt-3">Students Tab (NEW)</h5>
                <p>Individual student performance viewer:</p>
                <ul>
                    <li>Master-detail pattern: click any student to see daily breakdown</li>
                    <li>All 411 students in sortable table</li>
                    <li>Filters: Grade, Team, Date range</li>
                    <li>Columns: Name, Grade, Team, Class, Fundraising, Reading, Sponsors, Participation</li>
                    <li>Gold highlights for school-wide top performers, silver for grade-level leaders</li>
                    <li>Detail view shows: Daily reading log, goal achievement, sponsor info, totals</li>
                </ul>

                <div class="alert alert-info">
                    <strong><i class="bi bi-info-circle"></i> Filter Persistence:</strong>
                    Date, team, and grade filters persist as you navigate between tabs - your selections are remembered!
                </div>
            </div>
        </div>

        <!-- Business Logic -->
        <div class="card mb-4" id="business-logic">
            <div class="card-header bg-dark text-white">
                <h4 class="mb-0"><i class="bi bi-calculator"></i> Business Logic & Rules</h4>
            </div>
            <div class="card-body">
                <h5>Key Definitions</h5>
                <dl class="row">
                    <dt class="col-sm-3">Participation</dt>
                    <dd class="col-sm-9">A student "participated" if they read more than 0 minutes that day</dd>

                    <dt class="col-sm-3">Meeting Goal</dt>
                    <dd class="col-sm-9">A student "met their goal" if they read at least their grade's minimum daily minutes</dd>

                    <dt class="col-sm-3">Credited Minutes</dt>
                    <dd class="col-sm-9">Maximum 120 minutes per day counts toward totals (actual minutes are still tracked separately)</dd>

                    <dt class="col-sm-3">Tie-Breaking</dt>
                    <dd class="col-sm-9">When multiple entities tie for first place, ALL tied winners are shown</dd>
                </dl>

                <h5 class="mt-3">Grade Level Minimums</h5>
                <table class="table table-sm">
                    <thead class="table-light">
                        <tr>
                            <th>Grade</th>
                            <th>Daily Minimum</th>
                            <th>Max Credited</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Kindergarten (K)</td><td>20 minutes</td><td>120 minutes</td></tr>
                        <tr><td>Grade 1</td><td>20 minutes</td><td>120 minutes</td></tr>
                        <tr><td>Grade 2</td><td>25 minutes</td><td>120 minutes</td></tr>
                        <tr><td>Grade 3</td><td>25 minutes</td><td>120 minutes</td></tr>
                        <tr><td>Grade 4</td><td>30 minutes</td><td>120 minutes</td></tr>
                        <tr><td>Grade 5</td><td>30 minutes</td><td>120 minutes</td></tr>
                    </tbody>
                </table>

                <h5 class="mt-3">Teams</h5>
                <div class="row">
                    <div class="col-md-6">
                        <h6>Team Kitsko</h6>
                        <ul class="small">
                            <li>10 classes (including Mrs. Brown AM kindergarten)</li>
                            <li>207 students</li>
                            <li>Grades K-5</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Team Staub</h6>
                        <ul class="small">
                            <li>9 classes (including Mrs. Brown PM kindergarten)</li>
                            <li>204 students</li>
                            <li>Grades K-5</li>
                        </ul>
                    </div>
                </div>

                <div class="alert alert-info mt-3">
                    <strong><i class="bi bi-info-circle"></i> Note:</strong> Mrs. Brown teaches 2 separate kindergarten classes (AM and PM sessions), which is why there are 19 total classes from 18 teachers.
                </div>
            </div>
        </div>

        <!-- Troubleshooting -->
        <div class="card mb-4" id="troubleshooting">
            <div class="card-header card-header-blue">
                <h4 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            </div>
            <div class="card-body">
                <h5>Common Issues</h5>

                <div class="accordion" id="troubleshootingAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#trouble1">
                                "Student not found in roster" warnings
                            </button>
                        </h2>
                        <div id="trouble1" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
                            <div class="accordion-body">
                                <strong>Solution:</strong>
                                <ul>
                                    <li>Check that student names match exactly (case-sensitive)</li>
                                    <li>Verify CSV column names are correct</li>
                                    <li>Look for extra spaces in student names</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#trouble2">
                                Report shows "No data available"
                            </button>
                        </h2>
                        <div id="trouble2" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
                            <div class="accordion-body">
                                <strong>Solution:</strong>
                                <ul>
                                    <li>Make sure you've uploaded data first</li>
                                    <li>Check which environment you're in (Production vs Sample)</li>
                                    <li>Verify the date filter matches uploaded data</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#trouble3">
                                How do I reset/clear data?
                            </button>
                        </h2>
                        <div id="trouble3" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
                            <div class="accordion-body">
                                <strong>Solution:</strong>
                                <ol>
                                    <li>Stop the application (CTRL+C in Terminal)</li>
                                    <li>Delete the database file:
                                        <ul>
                                            <li><code>rm readathon_prod.db</code> for production</li>
                                            <li><code>rm readathon_sample.db</code> for sample</li>
                                        </ul>
                                    </li>
                                    <li>Run <code>python3 init_data.py</code> to recreate</li>
                                    <li>Restart the application</li>
                                </ol>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#trouble4">
                                Port 5000 is already in use
                            </button>
                        </h2>
                        <div id="trouble4" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
                            <div class="accordion-body">
                                <strong>Solution:</strong>
                                <ol>
                                    <li>Open <code>app.py</code> in a text editor</li>
                                    <li>Find line 197: <code>app.run(debug=True, host='127.0.0.1', port=5000)</code></li>
                                    <li>Change <code>port=5000</code> to <code>port=5001</code> (or another port)</li>
                                    <li>Save and restart the application</li>
                                    <li>Access at <code>http://localhost:5001</code></li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tips & Tricks -->
        <div class="card mb-4" id="tips-tricks">
            <div class="card-header card-header-blue">
                <h4 class="mb-0"><i class="bi bi-lightbulb"></i> Tips & Tricks</h4>
            </div>
            <div class="card-body">
                <ul>
                    <li><strong>Test in Sample:</strong> Try new features in Sample environment before using in Production</li>
                    <li><strong>Copy to Clipboard:</strong> Fastest way to get data into your slideshow - just paste!</li>
                    <li><strong>Export to CSV:</strong> Use this for Excel analysis or archiving</li>
                    <li><strong>Run Reports Multiple Times:</strong> Reports don't change your data - run them as often as you like</li>
                    <li><strong>Prize Drawing Randomness:</strong> Q4 picks different winners each time - run it until you're ready to announce</li>
                    <li><strong>Workflows Save Time:</strong> Use QD workflow every day instead of running 5 separate reports</li>
                    <li><strong>Database Comparison for Trends:</strong> Use Admin ‚Üí Database Comparison to track year-over-year growth across all 50 metrics</li>
                    <li><strong>Prepare for Next Year:</strong> Use Admin ‚Üí Database Creation to set up next year's database in advance</li>
                    <li><strong>Multi-Year Planning:</strong> Keep all your historical databases in the Database Registry for easy access to past years' data</li>
                </ul>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center text-muted pb-4">
            <hr>
            <p>
                <i class="bi bi-book"></i> Read-a-Thon Reporting System<br>
                <small>Built with Flask & Bootstrap | Data stored locally on your Mac</small>
            </p>
            <p>
                <a href="/" class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-house"></i> Back to Dashboard
                </a>
            </p>
        </div>
    </div>
</div>
{% endblock %}
